#!/usr/bin/env python

import os
import sys
from numpy.distutils.core import setup, Extension
from distutils.util import split_quoted


common_library_dirs = []

include_dirs = [
    '@DMTOOL_INCLUDE_DIR@',
    os.environ['INCLTDL'][2:],
    '@top_srcdir@',
    '@top_srcdir@/libecs',
    '@top_srcdir@/libemc',
    ]

common_libraries = [
    os.environ.get('BOOST_PYTHON_LIBNAME', 'boost_python'),
    'gsl'
    ]

ecell_staging_home = '@abs_top_builddir@/tmp'

for opt in split_quoted(os.environ.get('LIBS', '')):
    if opt[0:2] == '-L':
        common_library_dirs.append(opt[2:])
    elif opt[0:2] == '-l':
        common_libraries.append(opt[2:])
    elif opt[0] != '-':
        common_libraries.append(opt)

setup(
    name = 'E-Cell',
    version = @ECELL_VERSION_STRING@,
    description = 'E-Cell python library',
    author = 'E-Cell project',
    author_email = 'info@e-cell.org',
    url = 'http://www.e-cell.org/',
    packages = [ 'ecell', 'ecell.session_manager', 'ecell.analysis' ],
    ext_modules = [
        Extension( 'ecell._tableio',
			sources = [ 'ecell/_tableio.c' ],
            define_macros = sys.platform == 'win32' and
				[ ('WIN32','1'), ('_WIN32','1'), ('_SECURE_SCL', '0') ]
			),
        Extension(
            'ecell._ecs',
            include_dirs = include_dirs,
            library_dirs = [ ecell_staging_home + os.environ['libdir'] ] \
                           + common_library_dirs,
            libraries = common_libraries + [ 'ecs', 'emc' ],
            define_macros = sys.platform == 'win32' and
				[ ('BOOST_ALL_NO_LIB', '1'), ('WIN32','1'), ('_WIN32','1'), ('__STDC__', 1), ('_WIN32_WINNT', 0x500), ('_SECURE_SCL', '0') ],
            sources = [ 'ecell/_ecs.cpp' ] ),
        ]
    )
